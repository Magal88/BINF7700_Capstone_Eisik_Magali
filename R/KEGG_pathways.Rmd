---
title: "KEGG Pathway visualization"
author: "Magal√≠ Eisik"
output: html_notebook
---


The adjusted p-value represents the False Discovery Rate (FDR) correction, which accounts for multiple comparisons in the analysis. It reduces the likelihood of identifying false positives when testing many pathways simultaneously. In other words, it helps ensure that the pathways identified as significant are more reliable and not due to random chance.
Regarding this project, the pathways Inositol phosphate metabolism (hsa00562, FDR= 0.0050) and Phosphatidylinositol signaling system (hsa04070,FDR= 0.0050), showed the strongest enrichment after FDR correction. Both were hypomethylated, suggesting potential activation of signaling and metabolic processes. Given their involvement in intracellular signaling and energy regulation, they may reflect age-related methylation changes relevant to the epigenetic clock.


```{r}
#Load require packages
if(!require(pathview)){
  BiocManager::install("pathview")
   library(pathview)
} else {
    library(pathview)
}
library(org.Hs.eg.db)
library(dplyr)
library(IlluminaHumanMethylation450kanno.ilmn12.hg19)
```

```{r}
#Load data set
top_cpgs <- read.csv("C:/Users/Owner/Desktop/BINF7770/Top20_CpGs.csv",
                     stringsAsFactors = FALSE)

```

```{r}

ann450k <- getAnnotation(IlluminaHumanMethylation450kanno.ilmn12.hg19)
ann450k_df <- as.data.frame(ann450k)

annotated_cpgs <- top_cpgs %>%
  left_join(ann450k_df[, c("Name", "UCSC_RefGene_Name")],
            by = c("CpG" = "Name"))

final_cpg_genes <- annotated_cpgs %>%
  tidyr::separate_rows(UCSC_RefGene_Name, sep = ";") %>%
  dplyr::rename(Gene = UCSC_RefGene_Name) %>%
  dplyr::filter(Gene != "") %>%
  dplyr::select(CpG, Gene, Methylation_Change)
```



```{r}
#Create table with genes and weight
gene_weights <- final_cpg_genes %>%
  distinct(Gene, .keep_all = TRUE) %>%
  left_join(top_cpgs[, c("CpG","Weight")], by = "CpG") %>%  
  dplyr::rename(GeneSymbol = Gene)
```

```{r message=FALSE,warning=FALSE}
#Convert to ENTREZID
entrez_mapping <- bitr(gene_weights$GeneSymbol,
                       fromType = "SYMBOL",
                       toType = "ENTREZID",
                       OrgDb = org.Hs.eg.db)
gene_weights <- gene_weights %>%
  left_join(entrez_mapping, by = c("GeneSymbol" = "SYMBOL"))

```
```{r}
# Create vector with fold changes
foldchanges <- gene_weights$Weight
names(foldchanges) <- gene_weights$ENTREZID

```



```{r}
# Pathway hsa00562
#Inositol phosphate metabolism
pathview(gene.data = foldchanges,
         pathway.id = "hsa03030")
```

```{r}
#Pathway hsa04070
#Phosphatidylinositol signaling system
pathview(gene.data = foldchanges,
         pathway.id = "hsa04070")
```

